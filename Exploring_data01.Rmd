---
title: "Exploring Data Part 1"
author: "Ian Vert"
date: "6/18/2021"
output: pdf_document
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
```

**This Data is from : https://data.chhs.ca.gov/dataset/infectious-disease**

**This Dataset is Infectious Diseases by disease, County Year, and Sex for the State of California.**

```{r}

library(tidyr)
library(stringr)
library(tibble)
library(dplyr)
library(ggplot2)

```

```{r}
new_df <- read.csv('infectious-diseases-by-county-year-and-sex.csv')
head(new_df)
```

I have a DataFrame of 164,433 rows

## Cleaning the Data

The Rate Column can have multiple different entries which would make it difficult to analyze.

First I will remove any rows that have a '-' in the Rate column as this indicases a Zero case counts according to the documentation.


```{r}

new_df$Rate[new_df$Rate == '-'] <- NA

disease <- new_df %>% drop_na() 

```


I now have a DataFrame of 33,984 rows


Now I need to remove any rows that have a '*' at the end of the Rate, because according to the documentation, 'indicates an unstable relative standard error wherein the relative standard error was 23 percent or more of the incidence rate estimate--a threshold recommended by the National Center for Health Statistics.'


```{r}

new_vc <- vector()
for (x in disease$Rate) {
  if (str_sub(x, -1,-1) == '*'){
    x <- NA}
    new_vc <- c(new_vc,x)
  } 
    
```


Here I created a subset of the Dataset without the rate column then added new_vc from the code chunk above


```{r}

disease_sub <- subset(disease, select = -Rate)


disease_sub$Rate <- new_vc


disease_data <- disease_sub %>% drop_na()

```


Now without the rows with a Rate with a '*' we now have a DataFrame of 9,202 rows. 


```{r}

disease_data$Rate <- as.numeric(disease_data$Rate) 
glimpse(disease_data)
```

Now that the dataset is ready for analysis I will change it to the Tibble.

```{r}

clean_disease_data <- as_tibble(disease_data)


invisible(write.csv(clean_disease_data, 'clean_disease_data.csv'))

head(clean_disease_data)

```


For each Disease and year the 'Sex' column has 'Male', 'Female', and 'Total', Currently I am only focused on Total number of cases. I due plan on analyzing Sex specific data later.


```{r}

total_clean_disease_data <- clean_disease_data %>% filter(Sex == 'Total')

head(total_clean_disease_data)

```


##  Key question: What are the top 6 Diseases with the highest mean number of cases?


```{r}

avg_total_clean_disease_data <- total_clean_disease_data %>% group_by(Disease) %>% mutate(mean(Cases)) 

head(avg_total_clean_disease_data)

```


```{r}

unique(avg_total_clean_disease_data %>% select(Disease, `mean(Cases)`)) %>% arrange(desc(`mean(Cases)`))

```


The top 6 Diseases with the highest mean number of cases are Coccidioidomycosis, Campylobacteriosis, Salmonellosis, Shigellosis, Giardiasis, Amebiasis	


## Key Question: How do the cases of these 6 Diseases change over time?

```{r}


total_top_six <- total_clean_disease_data %>% filter(Disease == 'Campylobacteriosis' | 
                                                      Disease == 'Coccidioidomycosis'|
                                                      Disease == 'Salmonellosis' | 
                                                      Disease == 'Giardiasis' | 
                                                      Disease == 'Amebiasis')

head(total_top_six)

```



```{r}

sum_total_clean_disease_data <- unique(total_top_six %>%
              group_by(Year, Disease) %>% 
              mutate(sum(Cases)) %>% 
              select(Disease,Year, `sum(Cases)`) %>% 
              arrange((Year)))

head(sum_total_clean_disease_data,10)

```


```{r}


p <- sum_total_clean_disease_data %>% ggplot(mapping = aes(x = Year , 
                                                           y = `sum(Cases)`,
                                                           color = Disease)) +
  geom_line(aes(group = Disease)) +
  
  scale_x_continuous(breaks = round(seq(min(sum_total_clean_disease_data$Year),
                                        max(sum_total_clean_disease_data$Year),
                                        by = 2))) +
  labs(x = 'Year',
       y = 'Cases',
       title = 'Cases of the Six most Common Infectious Diseases by Year (2001-2019)') 
  
p  
  
```

## Interesting Notes from the graph:

Campylobacteriosis has increased steadily since 2006 and Coccidioidomycosis increased steadily since 2014

Coccidioidomycosis had a spike in cases from 2009 to 2011 and decreased from 2011 to 2014 

While Amebiasis and Giardiasis are both fairly stable in cases while Salmonellosis is sporadic 


